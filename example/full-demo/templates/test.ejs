import { describe, it, expect, beforeEach } from 'vitest';
import { <%= name %>Service } from './<%= nameLower %>.service';

describe('<%= name %>Service', () => {
  let service: <%= name %>Service;

  beforeEach(() => {
    service = new <%= name %>Service();
  });

  it('should create a <%= nameLower %>', async () => {
    const input = {
<% fields.forEach(function(field) { -%>
<% if (field.type === 'string') { -%>
      <%= field.name %>: 'test-<%= field.name %>',
<% } else if (field.type === 'number') { -%>
      <%= field.name %>: 42,
<% } else if (field.type === 'boolean') { -%>
      <%= field.name %>: true,
<% } -%>
<% }); -%>
    };
    const result = await service.create(input);
    expect(result).toHaveProperty('id');
    expect(result).toHaveProperty('createdAt');
    expect(result).toHaveProperty('updatedAt');
<% fields.forEach(function(field) { -%>
<% if (field.type === 'string') { -%>
    expect(result.<%= field.name %>).toBe('test-<%= field.name %>');
<% } else if (field.type === 'number') { -%>
    expect(result.<%= field.name %>).toBe(42);
<% } else if (field.type === 'boolean') { -%>
    expect(result.<%= field.name %>).toBe(true);
<% } -%>
<% }); -%>
  });

  it('should return all <%= namePlural %>', async () => {
    const items = await service.getAll();
    expect(Array.isArray(items)).toBe(true);
  });

  it('should return null for non-existent id', async () => {
    const result = await service.getById('non-existent');
    expect(result).toBeNull();
  });

  it('should delete a <%= nameLower %>', async () => {
    const created = await service.create({
<% fields.forEach(function(field) { -%>
<% if (field.type === 'string') { -%>
      <%= field.name %>: 'to-delete',
<% } else if (field.type === 'number') { -%>
      <%= field.name %>: 0,
<% } else if (field.type === 'boolean') { -%>
      <%= field.name %>: false,
<% } -%>
<% }); -%>
    });
    const deleted = await service.remove(created.id);
    expect(deleted).toBe(true);
  });

  it('should return false when deleting non-existent', async () => {
    const deleted = await service.remove('non-existent');
    expect(deleted).toBe(false);
  });
});
